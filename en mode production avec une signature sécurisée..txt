Voici la procédure complète, étape par étape, pour passer ton SaaS Hlass Tech en mode production avec une signature sécurisée. Cela supprimera définitivement le popup après la première validation.

Étape 1 : Générer tes clés HlassTech (OpenSSL)
Ouvre ton terminal (ou Git Bash sur Windows) et exécute ces deux commandes :

Générer la clé privée : openssl genrsa -out private-key.pem 2048

Générer le certificat public : openssl req -new -x509 -key private-key.pem -out digital-certificate.txt -days 3650

Note : Réponds aux questions. Pour "Common Name", mets HlassTech SaaS.

Étape 2 : Configurer le Backend (Laravel)
Dans ton fichier .env : Ouvre private-key.pem avec un bloc-notes, copie tout le texte et colle-le ainsi :

Extrait de code
QZ_PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----\n...le reste de ta clé...\n-----END RSA PRIVATE KEY-----"
Créer la route de signature (routes/api.php) :

PHP
Route::post('/qz/sign', [App\Http\Controllers\QZController::class, 'sign']);
Créer le Controller (app/Http/Controllers/QZController.php) :

PHP
<?php
namespace App\Http\Controllers;
use Illuminate\Http\Request;

class QZController extends Controller {
    public function sign(Request $request) {
        $toSign = $request->input('request'); // Donnée envoyée par QZ Tray
        $privateKey = str_replace('\n', "\n", env('QZ_PRIVATE_KEY'));

        $pkeyid = openssl_get_privatekey($privateKey);
        openssl_sign($toSign, $signature, $pkeyid, "sha1WithRSAEncryption");
        openssl_free_key($pkeyid);

        return response(base64_encode($signature));
    }
}
Étape 3 : Configurer le Frontend (React)
Modifie ton fichier Services/qz-tray.js pour utiliser ton API :

JavaScript
import * as qz from 'qz-tray';
import AxiosClient from './AxiosClient'; // Ton instance Axios

export const initQzTray = async () => {
  if (qz.websocket.isActive()) return qz;

  // 1. Ton Certificat Public (Contenu de digital-certificate.txt)
  qz.security.setCertificatePromise((resolve) => {
    resolve(`-----BEGIN CERTIFICATE-----
... COLLE ICI LE CONTENU DE TON FICHIER digital-certificate.txt ...
-----END CERTIFICATE-----`);
  });

  // 2. Appel à ton API Laravel pour signer
  qz.security.setSignaturePromise((toSign) => {
    return (resolve, reject) => {
      AxiosClient.post('/qz/sign', { request: toSign })
        .then(response => resolve(response.data))
        .catch(err => reject(err));
    };
  });

  await qz.websocket.connect();
  return qz;
};
Étape 4 : Le test final (Action du client)
Une fois ce code déployé :

Le client lance QZ Tray sur sa machine.

Il ouvre ta page de caisse Hlass Tech.

Au moment de la première impression, un popup unique apparaîtra.

TRÈS IMPORTANT : Le client doit cocher la case "Remember this decision" (ou "Toujours faire confiance") puis cliquer sur Allow.

Résultat : Grâce à ta signature backend, QZ Tray ne redemandera plus jamais de confirmation, car il reconnaîtra la signature de HlassTech à chaque commande.

Pourquoi c'est parfait pour ton SaaS ?
Centralisé : Tu gères une seule clé pour tous tes clients.

Professionnel : Le nom "HlassTech" apparaît dans le certificat.

Automatique : L'imprimante ticket-thermique est pilotée sans aucune interaction humaine.